{"version":3,"sources":["broccoli/broccoli-tree-stabilizer.ts"],"names":["TreeStabilizer","TreeStabilizer.constructor","TreeStabilizer.rebuild","TreeStabilizer.cleanup","stabilizeTree"],"mappings":"AAAA,sCAAsC;AACtC,kDAAkD;AAElD,IAAO,EAAE,WAAW,IAAI,CAAC,CAAC;AAC1B,IAAI,aAAa,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;AAG/C;;;;;;;;;;;;;GAaG;AACH;IAKEA,wBAAmBA,SAAuBA;QAAvBC,cAASA,GAATA,SAASA,CAAcA;IAAGA,CAACA;IAG9CD,gCAAOA,GAAPA;QACEE,EAAEA,CAACA,SAASA,CAACA,IAAIA,CAACA,UAAUA,CAACA,CAACA;QAE9BA,yFAAyFA;QACzFA,UAAUA;QACVA,aAAaA,CAACA,IAAIA,CAACA,IAAIA,CAACA,SAASA,EAAEA,IAAIA,CAACA,UAAUA,CAACA,CAACA;IACtDA,CAACA;IAGDF,gCAAOA,GAAPA,cAAWG,CAACA;IACdH,qBAACA;AAADA,CAlBA,AAkBCA,IAAA;AAGD,uBAAsC,SAAS;IAC7CI,MAAMA,CAACA,IAAIA,cAAcA,CAACA,SAASA,CAACA,CAACA;AACvCA,CAACA;AAFD;+BAEC,CAAA","file":"broccoli/broccoli-tree-stabilizer.js","sourcesContent":["/// <reference path=\"broccoli.d.ts\" />\n/// <reference path=\"../typings/node/node.d.ts\" />\n\nimport fs = require('fs');\nlet symlinkOrCopy = require('symlink-or-copy');\n\n\n/**\n * Stabilizes the inputPath for the following plugins in the build tree.\n *\n * All broccoli plugins that inherit from `broccoli-writer` or `broccoli-filter` change their\n * outputPath during each rebuild.\n *\n * This means that all following plugins in the build tree can't rely on their inputPath being\n * immutable. This results in breakage of any plugin that is not expecting such behavior.\n *\n * For example all `DiffingBroccoliPlugin`s expect their inputPath to be stable.\n *\n * By inserting this plugin into the tree after any misbehaving plugin, we can stabilize the\n * inputPath for the following plugin in the tree and correct the surprising behavior.\n */\nclass TreeStabilizer implements BroccoliTree {\n  inputPath: string;\n  outputPath: string;\n\n\n  constructor(public inputTree: BroccoliTree) {}\n\n\n  rebuild() {\n    fs.rmdirSync(this.outputPath);\n\n    // TODO: investigate if we can use rename the directory instead to improve performance on\n    // Windows\n    symlinkOrCopy.sync(this.inputPath, this.outputPath);\n  }\n\n\n  cleanup() {}\n}\n\n\nexport default function stabilizeTree(inputTree) {\n  return new TreeStabilizer(inputTree);\n}\n"],"sourceRoot":"/source/"}